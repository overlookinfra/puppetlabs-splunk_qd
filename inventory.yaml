version: 2
groups:
  - name: search_head
    targets:
      - _plugin: terraform
        dir: .
        resource_type: aws_instance.search_head
        uri: public_ip
    config:
      ssh:
        host: public_dns
    vars:
      addons:
        - name: Splunk_TA_nix
          filename: splunk-add-on-for-unix-and-linux_602.tgz
          inputs:
            monitor:///var/log:
              whitelist: (\.log|log$|messages|secure|auth|mesg$|cron$|acpid$|\.out)
              blacklist: (lastlog|anaconda\.syslog)
              disabled:  false
            script://./bin/uptime.sh:
              interval:   86400
              source:     Unix:Uptime
              sourcetype: Unix:Uptime
              disabled:   false
          additional_settings:
            is_configured:
              filename: app.conf
              section: install
              value: true
            is_visible:
              filename: app.conf
              section: ui
              value: false
        - name: splunk_app_for_nix
          filename: splunk-app-for-unix-and-linux_525.tgz
          additional_settings:
            is_configured:
              filename: app.conf
              section: install
              value: true
        - name: TA-puppet-report-viewer
          filename: puppet-report-viewer_200.tgz
          # inputs:
          #   http://puppet:summary
          #     sourcetype: puppet:summary
          #     token: 00000000-0000-0000-0000-000000000000
          #     disabled:  false
          #   http://puppet:detailed
          #     sourcetype: puppet:detailed
          #     token: 00000000-0000-0000-0000-000000000000
          #     disabled:  false              
  - name: forwarders
    targets:
      - _plugin: terraform
        dir: .
        resource_type: aws_instance.forwarder0
        uri: public_ip
      - _plugin: terraform
        dir: .
        resource_type: aws_instance.forwarder1
        uri: public_ip
      - _plugin: terraform
        dir: .
        resource_type: aws_instance.forwarder2
        uri: public_ip          
    config:
      ssh:
        host: public_dns
    vars:
      addons:
        - name: Splunk_TA_nix
          filename: splunk-add-on-for-unix-and-linux_602.tgz
          inputs:
            monitor:///var/log:
              whitelist: (\.log|log$|messages|secure|auth|mesg$|cron$|acpid$|\.out)
              blacklist: (lastlog|anaconda\.syslog)
              disabled:  false
            script://./bin/uptime.sh:
              interval:   86400
              source:     Unix:Uptime
              sourcetype: Unix:Uptime
              disabled:   false
          additional_settings:
            is_configured:
              filename: app.conf
              section: install
              value: true
config:
  transport: ssh
  ssh:
    user: ec2-user
    private-key: ~/.ssh/id_rsa
    host-key-check: false
    run-as: root