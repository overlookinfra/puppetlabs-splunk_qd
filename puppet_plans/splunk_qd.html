<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Puppet Plan: splunk_qd
  
    &mdash; Documentation by YARD 0.9.19
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "puppet_plans::splunk_qd";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../puppet_plan_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (s)</a> &raquo;
    <span class='title'><span class='object_link'>Puppet Plans</span></span>
     &raquo; 
    <span class="title">splunk_qd</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="../puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Puppet Plan: splunk_qd</h1>
<div class="box_info">
  <dl>
    <dt>Defined in:</dt>
    <dd>
      plans/init.pp
    </dd>
  </dl>
</div>

  <h2>Summary</h2>
  The Bolt Plan here is the primary jumping off point for leveraging the
Splunk Quick Deploy module and facilitates orchestrating purpose built tasks
and utilizing the **puppet/splunk** module through remote execution of
agentless Puppet. The default operating mode of this plan is intended to
always be declarative and is designed to follow the roles and profiles
pattern for containing and defining interfaces to lower level application
specific modules. Since **puppetlabs/splunk_qd** does depend on profiles for
abstracting certain aspects of the installation and configuration of  Splunk
Enterprise, these profiles can easily be adapted and integrated into a
Puppet Enterprise infrastructure-as-code environment to ensure continuous
state enforcement.

<h2>Overview</h2>
<div class="docstring">
  <div class="discussion">
    
  </div>
</div>


<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Managing Splunk Enterprise and Universal Forwarders</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_bolt'>bolt</span> <span class='id identifier rubyid_plan'>plan</span> <span class='id identifier rubyid_run'>run</span> <span class='id identifier rubyid_splunk_qd'>splunk_qd</span></code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>Deploying the Universal Forwarder and pointing it at an existing Splunk
Enterprise infrastructure</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_bolt'>bolt</span> <span class='id identifier rubyid_plan'>plan</span> <span class='id identifier rubyid_run'>run</span> <span class='id identifier rubyid_splunk_qd'>splunk_qd</span> <span class='id identifier rubyid_search_host'>search_host</span><span class='op'>=</span><span class='id identifier rubyid_splunk0'>splunk0</span><span class='period'>.</span><span class='id identifier rubyid_example'>example</span><span class='period'>.</span><span class='id identifier rubyid_com'>com</span></code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>Upgrading to a new revision of the Splunk Enterprise and Universal
Forwarder</p>
</div></p>
      
      <pre class="example code"><code>bolt plan run splunk_qd version=7.2.6 build=c0bf0f679ce9</code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>version</span>
      
      
        <span class='type'>(<tt>String[1]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;7.2.5&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The version number of either Splunk Enterprise or Universal Forwarder that
you wish to have downloaded from Splunk and installed</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>build</span>
      
      
        <span class='type'>(<tt>String[1]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;088f49762779&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Each version of the packages published by Splunk also have a specific build
string that is required for constructing the proper URL for remote fetching</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>search_host</span>
      
      
        <span class='type'>(<tt>Optional[String[1]]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Parameter is optional and depends on mode of operation. If you&#39;ve
defined an inventory group or host with the alias
<strong>search_head</strong> than this value will be transformed into that
node&#39;s host name or IP address but if you do not define that than this
needs to be set to tell managed Universal forwarders where to send their
data</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>manage_addons</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Temporarily disable the management of add-ons when they are defined in your
<code>inventory.yaml</code> file, add-ons will never be managed if they are
not defined within the <code>inventory.yaml</code> file</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>manage_forwarders</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Explicitly disable the management of the Universal Forwarder</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>manage_search</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Explicitly disable the management of Splunk Enterprise</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>web_ssl</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>To configure Splunk Enterprise Web with SSL and redirect traffic on port 80
to 443</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>web_ssl_mode</span>
      
      
        <span class='type'>(<tt>Optional[Enum['internal', 'letsencrypt']]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Switch between the two available SSL providers supported by the module</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>web_ssl_reg_email</span>
      
      
        <span class='type'>(<tt>Optional[String[1]]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>When using the <code>letsencrypt</code> SSL provider you must provide an
email address to be used as an account that the certificate will be
registered to</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>web_ssl_reg_fqdn</span>
      
      
        <span class='type'>(<tt>Optional[String[1]]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Sets the common name on the generated and signed certificate when using the
<code>letsencrypt</code> SSL provider</p>
</div>
      
    </li>
  
</ul>


  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="https://puppetlabs.github.io/puppetlabs-splunk_qd" target="_parent" title="https://puppetlabs.github.io/puppetlabs-splunk_qd">https://puppetlabs.github.io/puppetlabs-splunk_qd</a></li>
    
  </ul>

</div><div class="method_details_list">
  <table class="source_code">
    <tr>
      <td>
        <pre class="lines">


66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165</pre>
      </td>
      <td>
        <pre class="code"><span class="info file"># File 'plans/init.pp', line 66</span>

plan splunk_qd(
  String[1] $version                                      = &#39;7.2.5&#39;,
  String[1] $build                                        = &#39;088f49762779&#39;,
  Optional[String[1]] $search_host                        = undef,
  Boolean $manage_addons                                  = true,
  Boolean $manage_forwarders                              = true,
  Boolean $manage_search                                  = true,
  Boolean $web_ssl                                        = false,
  Optional[Enum[&#39;internal&#39;, &#39;letsencrypt&#39;]] $web_ssl_mode = undef,
  Optional[String[1]] $web_ssl_reg_email                  = undef,
  Optional[String[1]] $web_ssl_reg_fqdn                   = undef,
) {

  # Alwasy look this up since we have a use for the data defined with it even if
  # we do not plan on managing the node and its fine if if returns nil
  $search_head = get_targets(&#39;search_head&#39;)


  # Conditional to disable search node management
  if $manage_search {

    if $web_ssl {
      $_ssl = merge($search_head[0].vars[&#39;ssl&#39;], {
        &#39;mode&#39;      =&gt; $web_ssl_mode,
        &#39;reg_email&#39; =&gt; $web_ssl_reg_email,
        &#39;reg_fqdn&#39;  =&gt; $web_ssl_reg_fqdn,
      }.filter |$setting| { $setting[1] != undef })
    }

    # Ensures the agentless Puppet helper is installed and gathers facts, always
    # have to run the apply_prep function ahead of an apply block even if the
    # helper is installed or most Puppet modules are going to fail since they
    # rely heavily on facts
    $search_head.apply_prep

    # Function informing Bolt that we are going to execute agentless Puppet
    # code on a remote set of nodes
    $manage_search_results = apply($search_head) {
      # Bolt makes it super easy to follow existing best practices and the all
      # great pieces of content found out in out broad ecosystem, as we&#39;ve done
      # here building a simple profile for manager Splunk Enterprise which in
      # turn utilizes the puppet/splunk module from Voxpupuli and can then be
      # reused again by a full Puppet Enterprise installation capable of
      # continuous enforcement
      class { &#39;splunk_qd::profile::search&#39;:
        version       =&gt; $version,
        build         =&gt; $build,
        manage_addons =&gt; $manage_addons,
        addons        =&gt; $addons,
        web_ssl       =&gt; $web_ssl,
        ssl           =&gt; defined(&#39;$_ssl&#39;) ? { true =&gt; $_ssl, default =&gt; {} },
      }
    }
    if $manage_search_results.first.report[&#39;status&#39;] == &#39;changed&#39; {
      if $web_ssl {
        if $_ssl[&#39;reg_fqdn&#39;] {
          $success_url = &quot;https://${_ssl[&#39;reg_fqdn&#39;]}&quot;
        } else {
          $success_url = &quot;https://${search_head[0].host}&quot;
        }
      } else {
        $success_url = &quot;http://${search_head[0].host}:8000&quot;
      }
      notice(&quot;Splunk Enterprise is now ready at ${success_url}&quot;)
    }
  }

  # Everything from here on down is pretty similar to what&#39;s above with a couple
  # exceptions...
  if $manage_forwarders {
    if ! defined(&#39;$manage_search_results&#39;) or $manage_search_results.ok {

      $forwarders = get_targets(&#39;forwarders&#39;)

      # Checks to see if search_host was set on the command line and if so
      # prioritizes is value, then copies it into a private variable to be passed
      # into our forwarder profile. If the variable was not set then it attempts
      # to derive it from the search_head object found in the inventory.yaml file.
      if $search_host {
        $_search_host = $search_host
      } else {
        $_search_host = $search_head[0].host
      }

      $forwarders.apply_prep

      apply($forwarders) {
        class { &#39;splunk_qd::profile::forward&#39;:
          version       =&gt; $version,
          build         =&gt; $build,
          manage_addons =&gt; $manage_addons,
          addons        =&gt; $addons,
          search_host   =&gt; $_search_host,
        }
      }
    } else {
      fail_plan(&#39;Universal Forwarder configuration skipped due to previous failure configuring Splunk Enterprise&#39;)
    }
  }
}</pre>
      </td>
    </tr>
  </table>
</div>
</div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>